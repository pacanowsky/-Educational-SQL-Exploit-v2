from flask import Flask, request
import sqlite3
import logging

app = Flask(__name__)

# Logging Configuration
logging.basicConfig(level=logging.INFO)

# Create an in-memory database
conn = sqlite3.connect(':memory:', check_same_thread=False)
c = conn.cursor()
c.execute('''CREATE TABLE users (id INTEGER PRIMARY KEY, username TEXT, password TEXT)''')
c.execute("INSERT INTO users (username, password) VALUES (?, ?)", ('admin', 'password123'))
conn.commit()

@app.route('/', methods=['GET', 'POST'])
def login():
    error = 'Invalid credentials'
    if request.method == 'POST':
        username = request.form['username']
        password = request.form['password']
        
        logging.info(f"Received Username: {username}")  # Log received username
        logging.info(f"Received Password: {password}")  # Log received password
        
        # UNSAFE: Using string formatting to construct SQL query
        query = f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'"
        user = c.execute(query).fetchone()
        
        if user:
            return 'Logged in successfully!'
    return '''
        <form method="post">
            Username: <input type="text" name="username"><br>
            Password: <input type="password" name="password"><br>
            <input type="submit" value="Login">
        </form>
        ''' + error

if __name__ == '__main__':
    app.run(debug=True)
